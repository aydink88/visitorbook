import{p as u,e,F as a,B as b,T as B,h as N,C as i,a as c,L as S,R as p,I as E,b as $,c as T,d as U,y as z,q as O,u as L,N as x,f as I,g as k,i as R,j as W,k as M,l as C,m as V,P as q}from"./vendor.8f19fcea.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))l(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&l(h)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();const F=()=>{const[t,n]=u(null),[r,l]=u(""),[s,o]=u(""),[h,y]=u([]);return e("div",{className:"my-4",children:e(a,{onSubmit:async d=>{d.preventDefault();const v=new FormData;if(v.append("image",t),v.append("title",r),v.append("text",s),!!localStorage.getItem("token"))try{const w=await(await fetch("http://localhost:5000/api/v1/posts",{method:"post",headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("vb_token")}`},body:v})).json()}catch(m){y(w=>[...w,m])}},children:[e(a.Group,{controlId:"title",children:[e(a.Label,{children:"Title"}),e(a.Control,{type:"text",placeholder:"Enter a title",value:r,onChange:d=>{const v=d.target;l(v.value)}})]}),e(a.Group,{controlId:"content",children:[e(a.Label,{children:"Content"}),e(a.Control,{as:"textarea",rows:5,placeholder:"Post Content",value:s,onChange:d=>{const v=d.target;o(v.value)}})]}),e(a.Group,{children:e(a.Control,{type:"file",id:"file",name:"myImage",label:"picture",onChange:d=>{const g=d.target.files;n(g[0])}})}),e(b,{type:"submit",children:"Submit"})]})})},J=()=>e(F,{}),Y=()=>e(J,{}),K=(t,n=!0)=>{const[r,l]=u("idle"),[s,o]=u(null),[h,y]=u(null),f=B(()=>(l("pending"),o(null),y(null),t().then(d=>{o(d),l("success")}).catch(d=>{y(d),l("error")})),[t]);return N(()=>{n&&f()},[f,n]),{execute:f,status:r,value:s,error:h}},Q=()=>{const t=async()=>(await(await fetch("/api/v1/posts")).json()).posts,{execute:n,status:r,value:l,error:s}=K(t,!1);return N(()=>{n()},[]),r==="pending"?e("div",{className:"col-8",children:e("h1",{children:"Loading..."})}):s?e("div",{className:"col-8",children:e("h1",{children:s})}):e(p,{children:l&&l.map((o,h)=>e(i,{sm:6,lg:4,children:e(c,{className:"my-4 shadow rounded-lg overflow-hidden",children:e(c.Body,{className:"p-2",children:[e(c.Img,{variant:"top",src:`http://localhost:5000/${o.image}`}),e(c.Title,{className:"my-2",children:o.title}),e(c.Text,{children:e(S,{to:`/posts/${o._id}`,className:"btn btn-outline-primary btn-block mt-2",children:"See Content"})})]})},h)},o._id))})},X=()=>e(c,{className:"my-4",children:[e(c.Header,{as:"h5",children:"Search"}),e(c.Body,{children:e(E,{className:"mb-3",children:[e($,{placeholder:"Search for...","aria-label":"Search for...","aria-describedby":"basic-addon2"}),e(b,{variant:"secondary",children:"Go"})]})})]}),Z=()=>e(c,{className:"my-4",children:[e(c.Header,{as:"h5",children:"Categories"}),e(c.Body,{children:e(p,{children:[e(i,{lg:6,children:e("ul",{className:"list-unstyled mb-0",children:[e("li",{children:e("a",{href:"/",children:"Web Design"})}),e("li",{children:e("a",{href:"/",children:"HTML"})}),e("li",{children:e("a",{href:"/",children:"Freebies"})})]})}),e(i,{lg:6,children:e("ul",{className:"list-unstyled mb-0",children:[e("li",{children:e("a",{href:"/",children:"JavaScript"})}),e("li",{children:e("a",{href:"/",children:"CSS"})}),e("li",{children:e("a",{href:"/",children:"Tutorials"})})]})})]})})]}),ee=()=>e(c,{className:"my-4",children:[e(c.Header,{as:"h5",children:"Side Widget"}),e(c.Body,{children:"You can put anything you want inside of these side widgets. They are easy to use, and feature the new Bootstrap 4 card containers!"})]}),A=()=>e(T,{children:[e(X,{}),e(Z,{}),e(ee,{})]}),te=()=>e(p,{children:[e(i,{xs:12,md:8,children:e(Q,{})}),e(i,{xs:12,md:4,children:e(A,{})})]}),D=()=>localStorage.getItem("vb_token"),G={async post(t,n){return(await fetch(t,{credentials:"include",method:"post",body:JSON.stringify(n),headers:{Authorization:`Bearer ${D()}`,"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}})).json()},async get(t){return(await fetch(t,{credentials:"include",headers:{Authorization:`Bearer ${D()}`,"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}})).json()}},re=async(t,n)=>{try{const r=await G.post("/api/v1/auth/login",{email:t,password:n});return localStorage.setItem("vb_token",r.token),r.userId}catch(r){console.log(r)}},ne=async(t=localStorage.getItem("vb_token"))=>{if(!t)return;let n;try{n=(await G.get("/api/v1/auth/verify-token")).userId}catch(r){console.log(r.message)}return n||!1},ae=async()=>{try{return(await G.get("/api/v1/users")).users}catch(t){console.log(t)}},se=()=>{const[t,n]=u([]);return N(()=>{ae().then(r=>n(r))},[]),e(i,{xs:12,children:e(p,{children:t&&t.map(r=>e(i,{xs:12,md:6,lg:4,children:e(c,{className:"m-4",children:[r.avatar&&e("img",{height:"150px",style:{objectFit:"scale-down"},className:"card-img-top m-2",src:`http://localhost:5000/${r.avatar}`,alt:"CardImage"}),e(c.Body,{children:[e(c.Title,{className:"text-center",children:r.username}),e(S,{to:`/users/${r._id}`,className:"btn btn-outline-primary btn-block mt-2",children:"See Profile"})]})]})},r._id))})})},oe=()=>e(se,{}),H={userId:null,error:null,status:"idle"},le={auth:H,authenticate:(t,n)=>{},logout(){}},ce={idle:()=>H,pending:()=>({userId:null,error:null,status:"pending"}),success:t=>({userId:t,error:null,status:"success"}),error:t=>({userId:null,error:t,status:"error"})},ie=(t,n)=>ce[n.type](n.payload),j=U(le);function de({children:t}){const[n,r]=z(ie,H),l=B((o,h)=>{r({type:"pending"}),re(o,h).then(y=>r({payload:y,type:"success"})).catch(y=>r({type:"error",payload:y.message||"login failed"}))},[]),s=B(()=>{localStorage.removeItem("vb_token"),r({type:"idle"})},[]);return N(()=>{r({type:"pending"}),ne().then(o=>{o&&r({payload:o,type:"success"})}).catch(o=>r({payload:o.message||"Verifying Session failed",type:"error"}))},[]),e(j.Provider,{value:{auth:n,authenticate:l,logout:s},children:t})}const P=()=>{const t=O(j);if(!t)throw new Error("context should be in the provider");return t},he=()=>{const[t,n]=u(""),[r,l]=u(""),{auth:s,authenticate:o}=P(),h=L();return N(()=>{s.userId&&h("/")},[s.userId]),e(T,{children:e(a,{onSubmit:async f=>{f.preventDefault(),o(t,r)},children:[e(a.Group,{as:p,controlId:"formHorizontalEmail",children:[e(a.Label,{column:!0,sm:3,children:"Email"}),e(i,{sm:9,children:e(a.Control,{type:"email",placeholder:"Email",onChange:f=>{const d=f.target;n(d.value)}})})]}),e(a.Group,{as:p,controlId:"formHorizontalPassword",children:[e(a.Label,{column:!0,sm:3,children:"Password"}),e(i,{sm:9,children:e(a.Control,{type:"password",placeholder:"Password",onChange:f=>{const d=f.target;l(d.value)}})})]}),e(a.Group,{as:p,controlId:"formHorizontalCheck",children:e(i,{sm:9,className:"ml-auto",children:e(a.Check,{label:"Remember me"})})}),e(a.Group,{as:p,children:e(i,{sm:9,className:"ml-auto",children:e(b,{type:"submit",className:"w-100",children:"Log in"})})})]})})},ue=()=>e(p,{children:e(i,{sm:8,md:6,lg:4,className:"mx-auto my-5",children:e(he,{})})}),me=({variant:t})=>{const{auth:n,logout:r}=P(),l=L(),s=()=>{r(),l("/")};return N(()=>{console.log("authbuttons use effect")},[]),n.userId?e(x,{children:e(b,{size:"sm",onClick:s,children:"Log out"})}):e(x,{style:{gap:"1rem"},className:"font-weight-bold",children:[e(b,{variant:t,size:"sm",as:S,to:"/login",children:"Log in"}),e(b,{variant:`outline-${t}`,size:"sm",as:S,to:"/signup",children:"Sign up"})]})},pe=()=>e(I,{collapseOnSelect:!0,expand:"md",bg:"primary",variant:"dark",children:[e(I.Brand,{as:k,to:"/",children:["Simple Blog",e("img",{style:{height:"30px"},src:"/blog-logo.png",alt:"logo"})]}),e(I.Toggle,{"aria-controls":"responsive-navbar-nav"}),e(I.Collapse,{id:"responsive-navbar-nav",children:[e(x,{className:"mr-auto",children:[e(x.Link,{as:k,to:"/posts",children:"Posts"}),e(x.Link,{as:k,to:"/users",children:"Users"})]}),e(me,{variant:"light"})]})]}),ge=()=>e("footer",{className:"py-3 bg-dark",children:e("div",{className:"container",children:e("p",{className:"m-0 text-center text-white",children:["Copyright \xA9 Visitor Book ",new Date().getFullYear()]})})}),fe=()=>{const{auth:t}=P(),[n,r]=u(""),[l,s]=u(""),[o,h]=u(""),[y,f]=u(),d=L();return N(()=>{t.userId&&d("/")},[t.userId]),e(i,{md:12,lg:6,className:"mx-auto my-5",children:e(a,{onSubmit:async g=>{g.preventDefault(),console.log(g);const m=new FormData;m.append("username",n),m.append("email",l),m.append("password",o),m.append("avatar",y);try{const _=await(await fetch("http://localhost:5000/api/v1/auth/register",{method:"post",headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("vb_token")}`},body:m})).json();localStorage.setItem("token",_.token),d("/")}catch(w){console.log(w)}},children:[e(a.Group,{as:p,controlId:"formUsername",children:[e(a.Label,{column:!0,sm:2,children:"Username"}),e(i,{sm:10,children:e(a.Control,{type:"text",placeholder:"User Name",onChange:g=>{const m=g.target;r(m.value)}})})]}),e(a.Group,{as:p,controlId:"formEmail",children:[e(a.Label,{column:!0,sm:2,children:"Email"}),e(i,{sm:10,children:e(a.Control,{type:"email",placeholder:"Email",onChange:g=>{const m=g.target;s(m.value)}})})]}),e(a.Group,{as:p,controlId:"formPassword",children:[e(a.Label,{column:!0,sm:2,children:"Password"}),e(i,{sm:10,children:e(a.Control,{type:"password",placeholder:"Password",onChange:g=>{const m=g.target;h(m.value)}})})]}),e(a.Group,{children:e(a.Control,{type:"file",id:"avatar",label:"Profile picture",onChange:g=>{const w=g.target.files;f(w[0])}})}),e(a.Group,{className:"d-flex justify-content-end",controlId:"formCheck",children:e(a.Check,{label:"Remember me"})}),e(a.Group,{className:"d-flex justify-content-end",style:{gap:"1rem"},children:[e(b,{type:"button",children:"Clear Form"}),e(b,{type:"submit",children:"Sign Up"})]})]})})},ye=()=>{const{auth:t}=P(),n=L();return t.userId&&n("/"),e(fe,{})},ve=()=>{const[t,n]=u("");return e(c,{className:"my-4",children:[e(c.Header,{as:"h5",children:"Leave a Comment: "}),e(c.Body,{children:e(a,{onSubmit:()=>alert(t),children:e(E,{children:[e($,{as:"textarea","aria-label":"With textarea",rows:3,value:t,onChange:r=>{const l=r.currentTarget;n(l.value)}}),e(b,{type:"submit",children:"Submit"})]})})})]})},be=({comments:t})=>{let n;return t?n=t.map(r=>e(c,{className:"mb-4 shadow p-2",children:[e("img",{className:"d-flex mr-3 rounded-circle",src:"http://placehold.it/50x50",alt:""}),e(c.Body,{children:[e("h5",{className:"mt-0",children:r.name}),e("p",{children:r.text})]})]},r._id)):n=e("p",{children:"Loading"}),e("div",{className:"border rounded-lg px-4 py-1",children:[e("h2",{children:"Comments"}),n]})},Ce=({post:t})=>{var n,r;return t?e(T,{children:[e("h1",{className:"mt-4",children:t.title}),e("p",{className:"lead",children:["by ",(n=t.user)==null?void 0:n.username,e(S,{to:`/users/${(r=t.user)==null?void 0:r.username}`,children:" User's Profile"})]}),e("hr",{}),e("p",{children:["Posted on ",t.date]}),e("hr",{}),(t==null?void 0:t.image)&&e("img",{className:"img-fluid rounded",src:`http://localhost:5000/${t.image}`,alt:""}),e("hr",{}),e("div",{className:"lead",children:t.text}),e("hr",{})," "]}):e("h1",{children:"Loading..."})},Ne=()=>{const[t,n]=u(),{pid:r}=R(),l=async s=>{const h=await(await fetch(`http://localhost:5000/api/v1/posts/${s}`)).json();n(h.post)};return N(()=>{l(r)},[r]),t?e(p,{children:[e(i,{xs:12,md:8,children:[e(Ce,{post:t}),e(ve,{}),e(be,{comments:t.comments})]}),e(i,{xs:12,md:4,children:e(A,{})})]}):e("h1",{children:"Nothing..."})},we=()=>e(p,{children:[e(i,{xs:12,md:8,children:[e("p",{children:"Hello"}),e("p",{children:"Hello"}),e("p",{children:"Hello"}),e("p",{children:"Hello"}),e("p",{children:"Hello"}),e("p",{children:"Hello"})]}),e(i,{xs:12,md:4,children:e(A,{})})]});function xe(){return e(V,{children:[e(pe,{}),e(W,{className:"my-auto",children:e(M,{children:[e(C,{path:"/posts/new",element:e(F,{})}),e(C,{path:"/posts/:pid",element:e(Ne,{})}),e(C,{path:"/posts",element:e(te,{})}),e(C,{path:"/users",element:e(oe,{})}),e(C,{path:"/login",element:e(ue,{})}),e(C,{path:"/signup",element:e(ye,{})}),e(C,{path:"/profile",element:e(we,{})}),e(C,{path:"/",element:e(Y,{})})]})}),e(ge,{})]})}q(e(de,{children:e(xe,{})}),document.getElementById("app"));
