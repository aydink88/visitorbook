import{p as u,e,F as s,B as b,T as B,h as N,C as i,a as c,L as S,R as p,I as j,b as D,c as T,d as U,y as z,q as R,u as L,N as x,f as I,g as k,i as O,j as W,k as M,l as C,m as V,P as q}from"./vendor.a74ff18c.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&l(h)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerpolicy&&(o.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?o.credentials="include":a.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();const E=()=>{const[t,r]=u(null),[n,l]=u(""),[a,o]=u(""),[h,y]=u([]);return e("div",{className:"my-4",children:e(s,{onSubmit:async d=>{d.preventDefault();const v=new FormData;if(v.append("image",t),v.append("title",n),v.append("text",a),!!localStorage.getItem("token"))try{const w=await(await fetch("http://localhost:5000/api/v1/posts",{method:"post",headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("vb_token")}`},body:v})).json()}catch(m){y(w=>[...w,m])}},children:[e(s.Group,{controlId:"title",children:[e(s.Label,{children:"Title"}),e(s.Control,{type:"text",placeholder:"Enter a title",value:n,onChange:d=>{const v=d.target;l(v.value)}})]}),e(s.Group,{controlId:"content",children:[e(s.Label,{children:"Content"}),e(s.Control,{as:"textarea",rows:5,placeholder:"Post Content",value:a,onChange:d=>{const v=d.target;o(v.value)}})]}),e(s.Group,{children:e(s.Control,{type:"file",id:"file",name:"myImage",label:"picture",onChange:d=>{const g=d.target.files;r(g[0])}})}),e(b,{type:"submit",children:"Submit"})]})})},J=()=>e(E,{}),Y=()=>e(J,{}),K=(t,r=!0)=>{const[n,l]=u("idle"),[a,o]=u(null),[h,y]=u(null),f=B(()=>(l("pending"),o(null),y(null),t().then(d=>{o(d),l("success")}).catch(d=>{y(d),l("error")})),[t]);return N(()=>{r&&f()},[f,r]),{execute:f,status:n,value:a,error:h}},Q=()=>{const t=async()=>(await(await fetch("/api/v1/posts")).json()).posts,{execute:r,status:n,value:l,error:a}=K(t,!1);return N(()=>{r()},[]),n==="pending"?e("div",{className:"col-8",children:e("h1",{children:"Loading..."})}):a?e("div",{className:"col-8",children:e("h1",{children:a})}):e(p,{children:l&&l.map((o,h)=>e(i,{sm:6,lg:4,children:e(c,{className:"my-4 shadow rounded-lg overflow-hidden",children:e(c.Body,{className:"p-2",children:[e(c.Img,{variant:"top",src:`http://localhost:5000/${o.image}`}),e(c.Title,{className:"my-2",children:o.title}),e(c.Text,{children:e(S,{to:`/posts/${o._id}`,className:"btn btn-outline-primary btn-block mt-2",children:"See Content"})})]})},h)},o._id))})},X=()=>e(c,{className:"my-4",children:[e(c.Header,{as:"h5",children:"Search"}),e(c.Body,{children:e(j,{className:"mb-3",children:[e(D,{placeholder:"Search for...","aria-label":"Search for...","aria-describedby":"basic-addon2"}),e(b,{variant:"secondary",children:"Go"})]})})]}),Z=()=>e(c,{className:"my-4",children:[e(c.Header,{as:"h5",children:"Categories"}),e(c.Body,{children:e(p,{children:[e(i,{lg:6,children:e("ul",{className:"list-unstyled mb-0",children:[e("li",{children:e("a",{href:"/",children:"Web Design"})}),e("li",{children:e("a",{href:"/",children:"HTML"})}),e("li",{children:e("a",{href:"/",children:"Freebies"})})]})}),e(i,{lg:6,children:e("ul",{className:"list-unstyled mb-0",children:[e("li",{children:e("a",{href:"/",children:"JavaScript"})}),e("li",{children:e("a",{href:"/",children:"CSS"})}),e("li",{children:e("a",{href:"/",children:"Tutorials"})})]})})]})})]}),ee=()=>e(c,{className:"my-4",children:[e(c.Header,{as:"h5",children:"Side Widget"}),e(c.Body,{children:"You can put anything you want inside of these side widgets. They are easy to use, and feature the new Bootstrap 4 card containers!"})]}),A=()=>e(T,{children:[e(X,{}),e(Z,{}),e(ee,{})]}),te=()=>e(p,{children:[e(i,{xs:12,md:8,children:e(Q,{})}),e(i,{xs:12,md:4,children:e(A,{})})]}),re=()=>{const[t,r]=u([]),n=async()=>{const a=await(await fetch("/api/v1/users",{credentials:"include",headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json"}})).json();r(a.users)};return N(()=>{n()},[]),e(i,{xs:12,children:e(p,{children:t&&t.map(l=>e(i,{xs:12,md:6,lg:4,children:e(c,{className:"m-4",children:[l.avatar&&e("img",{height:"150px",style:{objectFit:"scale-down"},className:"card-img-top m-2",src:`http://localhost:5000/${l.avatar}`,alt:"CardImage"}),e(c.Body,{children:[e(c.Title,{className:"text-center",children:l.username}),e(S,{to:`/users/${l._id}`,className:"btn btn-outline-primary btn-block mt-2",children:"See Profile"})]})]})},l._id))})})},ne=()=>e(re,{}),H=()=>localStorage.getItem("vb_token"),$={async post(t,r){return(await fetch(t,{method:"post",body:JSON.stringify(r),headers:{Authorization:`Bearer ${H()}`,"Content-Type":"application/json"}})).json()},async get(t){return(await fetch(t,{credentials:"include",headers:{Authorization:`Bearer ${H()}`,"Content-Type":"application/json"}})).json()}},ae=async(t,r)=>{try{const n=await $.post("/api/v1/auth/login",{email:t,password:r});return localStorage.setItem("vb_token",n.token),n.userId}catch(n){console.log(n)}},se=async(t=localStorage.getItem("vb_token"))=>{if(!t)return;let r;try{r=(await $.get("/api/v1/auth/verify-token")).userId}catch(n){console.log(n.message)}return r||!1},G={userId:null,error:null,status:"idle"},oe={auth:G,authenticate:(t,r)=>{},logout(){}},le={idle:()=>G,pending:()=>({userId:null,error:null,status:"pending"}),success:t=>({userId:t,error:null,status:"success"}),error:t=>({userId:null,error:t,status:"error"})},ce=(t,r)=>le[r.type](r.payload),F=U(oe);function ie({children:t}){const[r,n]=z(ce,G),l=B((o,h)=>{n({type:"pending"}),ae(o,h).then(y=>n({payload:y,type:"success"})).catch(y=>n({type:"error",payload:y.message||"login failed"}))},[]),a=B(()=>{localStorage.removeItem("vb_token"),n({type:"idle"})},[]);return N(()=>{n({type:"pending"}),se().then(o=>{o&&n({payload:o,type:"success"})}).catch(o=>n({payload:o.message||"Verifying Session failed",type:"error"}))},[]),e(F.Provider,{value:{auth:r,authenticate:l,logout:a},children:t})}const P=()=>{const t=R(F);if(!t)throw new Error("context should be in the provider");return t},de=()=>{const[t,r]=u(""),[n,l]=u(""),{auth:a,authenticate:o}=P(),h=L();return N(()=>{a.userId&&h("/")},[a.userId]),e(T,{children:e(s,{onSubmit:async f=>{f.preventDefault(),o(t,n)},children:[e(s.Group,{as:p,controlId:"formHorizontalEmail",children:[e(s.Label,{column:!0,sm:3,children:"Email"}),e(i,{sm:9,children:e(s.Control,{type:"email",placeholder:"Email",onChange:f=>{const d=f.target;r(d.value)}})})]}),e(s.Group,{as:p,controlId:"formHorizontalPassword",children:[e(s.Label,{column:!0,sm:3,children:"Password"}),e(i,{sm:9,children:e(s.Control,{type:"password",placeholder:"Password",onChange:f=>{const d=f.target;l(d.value)}})})]}),e(s.Group,{as:p,controlId:"formHorizontalCheck",children:e(i,{sm:9,className:"ml-auto",children:e(s.Check,{label:"Remember me"})})}),e(s.Group,{as:p,children:e(i,{sm:9,className:"ml-auto",children:e(b,{type:"submit",className:"w-100",children:"Log in"})})})]})})},he=()=>e(p,{children:e(i,{sm:8,md:6,lg:4,className:"mx-auto my-5",children:e(de,{})})}),ue=({variant:t})=>{const{auth:r,logout:n}=P(),l=L(),a=()=>{n(),l("/")};return N(()=>{console.log("authbuttons use effect")},[]),r.userId?e(x,{children:e(b,{size:"sm",onClick:a,children:"Log out"})}):e(x,{style:{gap:"1rem"},className:"font-weight-bold",children:[e(b,{variant:t,size:"sm",as:S,to:"/login",children:"Log in"}),e(b,{variant:`outline-${t}`,size:"sm",as:S,to:"/signup",children:"Sign up"})]})},me=()=>e(I,{collapseOnSelect:!0,expand:"md",bg:"primary",variant:"dark",children:[e(I.Brand,{as:k,to:"/",children:["Simple Blog",e("img",{style:{height:"30px"},src:"/blog-logo.png",alt:"logo"})]}),e(I.Toggle,{"aria-controls":"responsive-navbar-nav"}),e(I.Collapse,{id:"responsive-navbar-nav",children:[e(x,{className:"mr-auto",children:[e(x.Link,{as:k,to:"/posts",children:"Posts"}),e(x.Link,{as:k,to:"/users",children:"Users"})]}),e(ue,{variant:"light"})]})]}),pe=()=>e("footer",{className:"py-3 bg-dark",children:e("div",{className:"container",children:e("p",{className:"m-0 text-center text-white",children:["Copyright \xA9 Visitor Book ",new Date().getFullYear()]})})}),ge=()=>{const{auth:t}=P(),[r,n]=u(""),[l,a]=u(""),[o,h]=u(""),[y,f]=u(),d=L();return N(()=>{t.userId&&d("/")},[t.userId]),e(i,{md:12,lg:6,className:"mx-auto my-5",children:e(s,{onSubmit:async g=>{g.preventDefault(),console.log(g);const m=new FormData;m.append("username",r),m.append("email",l),m.append("password",o),m.append("avatar",y);try{const _=await(await fetch("http://localhost:5000/api/v1/auth/register",{method:"post",headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("vb_token")}`},body:m})).json();localStorage.setItem("token",_.token),d("/")}catch(w){console.log(w)}},children:[e(s.Group,{as:p,controlId:"formUsername",children:[e(s.Label,{column:!0,sm:2,children:"Username"}),e(i,{sm:10,children:e(s.Control,{type:"text",placeholder:"User Name",onChange:g=>{const m=g.target;n(m.value)}})})]}),e(s.Group,{as:p,controlId:"formEmail",children:[e(s.Label,{column:!0,sm:2,children:"Email"}),e(i,{sm:10,children:e(s.Control,{type:"email",placeholder:"Email",onChange:g=>{const m=g.target;a(m.value)}})})]}),e(s.Group,{as:p,controlId:"formPassword",children:[e(s.Label,{column:!0,sm:2,children:"Password"}),e(i,{sm:10,children:e(s.Control,{type:"password",placeholder:"Password",onChange:g=>{const m=g.target;h(m.value)}})})]}),e(s.Group,{children:e(s.Control,{type:"file",id:"avatar",label:"Profile picture",onChange:g=>{const w=g.target.files;f(w[0])}})}),e(s.Group,{className:"d-flex justify-content-end",controlId:"formCheck",children:e(s.Check,{label:"Remember me"})}),e(s.Group,{className:"d-flex justify-content-end",style:{gap:"1rem"},children:[e(b,{type:"button",children:"Clear Form"}),e(b,{type:"submit",children:"Sign Up"})]})]})})},fe=()=>{const{auth:t}=P(),r=L();return t.userId&&r("/"),e(ge,{})},ye=()=>{const[t,r]=u("");return e(c,{className:"my-4",children:[e(c.Header,{as:"h5",children:"Leave a Comment: "}),e(c.Body,{children:e(s,{onSubmit:()=>alert(t),children:e(j,{children:[e(D,{as:"textarea","aria-label":"With textarea",rows:3,value:t,onChange:n=>{const l=n.currentTarget;r(l.value)}}),e(b,{type:"submit",children:"Submit"})]})})})]})},ve=({comments:t})=>{let r;return t?r=t.map(n=>e(c,{className:"mb-4 shadow p-2",children:[e("img",{className:"d-flex mr-3 rounded-circle",src:"http://placehold.it/50x50",alt:""}),e(c.Body,{children:[e("h5",{className:"mt-0",children:n.name}),e("p",{children:n.text})]})]},n._id)):r=e("p",{children:"Loading"}),e("div",{className:"border rounded-lg px-4 py-1",children:[e("h2",{children:"Comments"}),r]})},be=({post:t})=>{var r,n;return t?e(T,{children:[e("h1",{className:"mt-4",children:t.title}),e("p",{className:"lead",children:["by ",(r=t.user)==null?void 0:r.username,e(S,{to:`/users/${(n=t.user)==null?void 0:n.username}`,children:" User's Profile"})]}),e("hr",{}),e("p",{children:["Posted on ",t.date]}),e("hr",{}),(t==null?void 0:t.image)&&e("img",{className:"img-fluid rounded",src:`http://localhost:5000/${t.image}`,alt:""}),e("hr",{}),e("div",{className:"lead",children:t.text}),e("hr",{})," "]}):e("h1",{children:"Loading..."})},Ce=()=>{const[t,r]=u(),{pid:n}=O(),l=async a=>{const h=await(await fetch(`http://localhost:5000/api/v1/posts/${a}`)).json();r(h.post)};return N(()=>{l(n)},[n]),t?e(p,{children:[e(i,{xs:12,md:8,children:[e(be,{post:t}),e(ye,{}),e(ve,{comments:t.comments})]}),e(i,{xs:12,md:4,children:e(A,{})})]}):e("h1",{children:"Nothing..."})},Ne=()=>e(p,{children:[e(i,{xs:12,md:8,children:[e("p",{children:"Hello"}),e("p",{children:"Hello"}),e("p",{children:"Hello"}),e("p",{children:"Hello"}),e("p",{children:"Hello"}),e("p",{children:"Hello"})]}),e(i,{xs:12,md:4,children:e(A,{})})]});function we(){return e(V,{children:[e(me,{}),e(W,{className:"my-auto",children:e(M,{children:[e(C,{path:"/posts/new",element:e(E,{})}),e(C,{path:"/posts/:pid",element:e(Ce,{})}),e(C,{path:"/posts",element:e(te,{})}),e(C,{path:"/users",element:e(ne,{})}),e(C,{path:"/login",element:e(he,{})}),e(C,{path:"/signup",element:e(fe,{})}),e(C,{path:"/profile",element:e(Ne,{})}),e(C,{path:"/",element:e(Y,{})})]})}),e(pe,{})]})}q(e(ie,{children:e(we,{})}),document.getElementById("app"));
